# 마이크로 서비스 아키텍쳐

### 1.1 마이크로 서비스란 
- 작고 효율적으로 협업하는 서비스를 의미한다.

#### 1.1.1 작고 한가지일을 잘하는데 주력
- 명확하고 모듈화된 모놀리식 코드베이스를 유지하는것은 매우 어려운 일이다.
- 응집. 추상화. 모듈화는 MSA에서 중요한 개념이다.
- "같은이유로 변경되는것은 모으고, 다른이유로 인해 변경되는것은 분리해야한다."
    - SRP 단일 책임의 원칙
- 마이크로 서비스의 크기는 충분히 작아서 더 이상 작아질수 없는 크기라면 충분하다.
    

> 코드베이스란 ? 소프트웨어 시스템, 애플리케이션 에서 컴포넌트를 빌드하는데 사용되는코드 전체의 집합으로, 일반적으로 작성한 코드 파일을 의미한다.

#### 1.1.2 자율성
- 마이크로 서비스는 분리된 개체이다.
- PaaS (Platform as a Service) 상 격리된 서비스 또는 운영체제상 프로세스가 될 수 있다.
- 서비스간의 분산도는 높히고, 밀접하게 연결되어 생기는 문제점을 줄이기 위해 서비스간의 통신은 모두 네트워크 호출을 통해 이루어진다.
- 서로 독립적으로 변경 가능해야 하고, 사용자 수정 없이 배포 할 수 있어야한다.
- "무엇을 외부에 둘지, 무엇을 내부에 둘지에 대한 고민을 해야한다."
- 외부에 노출되는것이 많을수록 사용자와 협의해야할 것이 많아지기때문에 자율성이 떨어진다.
- 외부에 API를 공개하며, 이를 통해 상호 서비스들과 통신한다.

### 1.2 주요 혜택
- 마이크로 서비스가 제공하는 혜택은 많으면서도 다양하다.
- 대부분 다른 분산시스템에서도 제공하지만, 마이크로 서비스의 경우 분산시스템과 서비스지향 아키텍쳐의 개념을 더 깊기 내포하는만큼 더 많은 혜택을 누릴 수 있다.

#### 1.2.1 기술 이기종성
- 다수 서비스로 구성된 시스템의 경우 각 서비스가 다른 기술을 사용하도록 결정 할 수 있다.
- 만능의 접근 방식을 선택하기보다, 각 작업에 따라 적합한 도구를 선택할 수 있게 해준다.
- 시스템의 특정 성능을 향상 시켜야할때, 새로운 기술을 적용할때 마이크로서비스를 통해 더 신속히 적용이 가능하다.
- 새로운 기술을 시험하고, 도입할 때 최대 걸림돌은 잘 맞지 않을수 있다는 위험이다.
- 모놀리식 애플리케이션에서 새로운 기술을 적용하면 전체 애플리케이션에 영향을 미칠 것이다.
- 다양한 독립 서비스로 구성된 시스템에서는 새로운 기술분야를 적용할때 리스크가 적다.

#### 1.2.2 회복성
- 회복공학의 핵심은 격벽이다.
- 시스템의 컴포넌트가 장애가 나더라도 장애가 전파되지 않는다면, 해당 문제를 격리하고 시스템을 게속 작동할 수 있다.
- 서비스 전체 장애를 차단하고, 기능을 적절히 저하시키는 시스템 구축이 가능하다.
- 주의점: 향상된 회복력을 적절히 수용 할 수 있도록 분산 시스ㅔㅁ이 마주한 새로운 장애요인을 이해해야한다.

#### 1.2.3 확장성
- 모놀리식 애플리케이션에서는 항상 모든것을 함께 확장해야한다.
- 마이크로서비스 에서는 특정 서비스만 확장이 가능해 효율적인 자원 사용이 가능해진다.

#### 1.2.4 배포 용이성
- 모놀리식 애플리케이션은 한 줄만 수정되더라도 해당 버전을 릴리즈하기 위해서 전체 애플리케이션을 배포해야한다.
- 이는 막대한 영향을 끼치는 위험한 배포가 될 수 있다.
- 마이크로서비스를 이용하면 하나의 서비스만 변경할 수있고, 배포의 단위가 작아진다.
- 문제 발생시 해당 서비스만 롤백 함으로써 리스크를 최소화 할 수 있다.

#### 1.2.5 조직 부합성
- 마이크로서비스를 이용하면 아키텍처를 조직 구조에 맞게 더 적절히 정렬할 수 있다.
- 최적의 팀 크기와 생산성을 위해 하나의 코드베이스에서 일하는 인원을 최소화 할 수 있다.
- 서비스 소유권을 팀 간의 이전도 가능하다.

#### 1.2.6 조합성
- 분산 시스템과 서비스지향 아키텍처의 장점중 하나는 기능을 재사용할 기회가 많아진다는 것이다.
- 웹, 네이티브앱, 모바일 웹, 테블릿앱, 웨어러블장비 등을 위한 기능을 함께 엮을 무궁무진한 방법을 고민해야한다.

#### 1.2.7 대체 가능성을 위한 최적화
- 각 서비스가 작은 크기로 이루어져 있다면 교체비용을 줄일수 있으며 심지어 삭제도 쉽게 가능하다.
- 마이크로서비스는 대개 비슷한 크기로 이루어 지므로 서비스를 재작성 하거나 삭제하기 매우 쉽다.

### 1.3 서비스 지향 아키텍쳐란 
- Service-Oriented Architechture (SOA) 란 서비스의 최종 능력 집합 end set of capabilities 을 제공하는 여러**서비스**가 서로 협업하도록 설계 하는 접근 방식이다.
- SOA는 소프트웨어의 재사용성 장려를 목표로 한다. 둘 이상의 애플리케이션이 하나의 서비스를 사용할 수 있다.
- 서비스의 의미를 아주 많이 변경하지 않는한 이론적으로 다른서비스로 대체할 수 있어 유지보수와 재작성을 더 쉽게 한다.
- 실사용을 기반으로 출현한 마이크로서비스는 SOA에 적합한 시스템과 아키텍쳐를 더 잘 이해하게 해준다.
- 마이크로서비스는 SOA에 대한 특정 접근법으로 보아야 한다.

`서비스란 ?`
> 일반적으로 완전히 분리된 운영 시스템의 프로세스를 의미한다. 서비스 간 통신은 네트워크 호출로 이루어 진다.

### 1.4 기타 분해 기술
- 마이크로서비스 기반의 아키텍처의 수 많은 이점들은 마이크로서비스가 가진 세분화 특성과 문제해결을 위한 더 많은 선택의 기회를 제공하는데서 비롯된다.

#### 1.4.1 공유 라이브러리
- 모든 언어가 지원하는 표준 분해 기술은 코드베이스를 여러 라이브러리로 쪼개는 것이다.
- 이들 라이브러리는 서드파티 (외부) 에서 제공하거나 내부조직에서 만들 수 있다.

`단점`
- 1.진정한 기술 이기종성을 잃게 된다.
    - 일반적으로 라이브러리는 동일 언어에서 구현되거나 동일 플랫폼에서 실행되기 때문이다.
- 2.시스템 일부를 독립적으로 확장하기 힘들어 진다.
- 3.동적 라이브러리를 사용하지 않는 한 전체 프로세스를 재배포하지 않고서는 새로운 라이브러리를 배포할 수 없다. 변경부분만 격리하여 배포할 수 있는 능력이 떨어진다.
- 4.시스템 회복력을 보장하는 구조적 안전조치를 취할 명확한 접합부가 부족하다.

#### 1.4.2 모듈
- 일부 언어는 단순 라이브러라보다 뛰어난 독자적인 모듈 분해 기술을 제공한다.
- 이런 언어는 모듈의 수명주기 관리기능을 일부 제공한다.
- 프로세스를 종료하지 않고도 실행중인 프로세스에 변경된 모듈을 배포할 수 있다.

`OSGI`
- OSGI (Open Source Gateway Initiative) 는 모듈 분해를 실제로 구현해낸 대표적인 예다.
- OSGI 는 이클립스 자바통합 개발환경에 설치될 플러그인 프레임워크로 출현했고, 라이브러리를 통해 자바에 모듈 컨셉을 장착하는 방법으로 사용된다.
- 문제는 언어자체의 충분한 지원없이 수명주기 관리를 강제하려 한다는 점이다.

`Erlang`
- 얼랭 Erlang 은 모듈이 언어 런타임으로 생성된다.
- 이슈 없이도 멈추거나, 재시작하거나, 업그레이드 될 수 있다.
- 정해진 시간 내에 여러 버전의 모듈을 실행하는것을 지원한다.

> 이러한 역량을 가진 플랫폼을 사용하게 되더라도, 일반적인 공유 라이브러리를 사용할때의 결점은 여전히 존재한다.

> 한 프로세스 안에서 여러 모듈을 각각 서비스로 분해하더라도 그것이 모든 문제를 해결하지는 않는다.

### 1.5 은총알은 없다
- 마이크로서비스가 은총알도 아니며 황금망치로 오인되는 일은 없어야 한다.
- 분산 시스템과 연관된 모든 종류의 복잡성을 내포하고 있다.
- 모놀리식 관점에서 접근하고 있다면 배포, 테스트, 모니터링을 훨씬 더 잘다루어야 한다.













