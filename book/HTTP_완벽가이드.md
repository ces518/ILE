# HTTP 완벽 가이드

## HTTP: 웹의 기초

### 1장 HTTP 개관

#### 1.1 HTTP: 인터넷의 멀티미디어 배달부
- HTTP는 신뢰성 있는 데이터 전송 프로토콜을 사용 한다.
- HTTP 통신중 파괴되거나, 중복되거나, 왜곡되는 것을 걱정하지 않아도 된다.

#### 1.2 HTTP: 웹 클라이언트와 서버
- 웹 콘텐츠는 웹서버에 존재한다.
- 웹 서버는 HTTP 프로토콜로 통신하기 떄문에 HTTP 서버라고 불린다.
- 웹 서버는 HTTP 클라이언트가 요청한 데이터를 HTTP 응답으로 제공한다.
- HTTP 클라이언트와 HTTP 서버는 월드 와이드 웹의 기본 요소이다.

#### 1.3 리소스
- 웹 서버는 웹 리소스를 관리하고 제공한다.
- 리소스는 반드시 정적 파일이어야 할 필요는 없다.

> 어떤 종류의 콘텐츠 소스도 리소스가 될 수 있다.

##### 1.3.1 미디어 타입
- 수천 가지 데이터 타입을 다루기 때문에, HTTP는 웹에서 전송되는 객체 각각에 신중하게 MIME 타입이라는 데이터 포맷 라벨을 붙인다.
    - Multipurpose Internet Mail Extensions
- 원래 각기 다른 전자메일 시스템 사이에서 메시지가 오갈때 겪는 문제점을 해결하기 위해 설계 되었다.
- 웹 서버는 모든 HTTP 객체 데이터에 MIME타입을 붙인다.

##### 1.3.2 URI
- 서버 리소스 이름은 통합 자원 식별자 (Uniform Resource Identifier), 혹은 URI로 불린다.
- 인터넷의 우편물 주소 같은 것응로, 정보 리소스를 고유하게 식별하고 위치를 지정할 수 있다.
    - http://www.june.me/items/1

##### 1.3.3 URL
- 통합 자원 지시자 (Uniform Resource Locator) URL은 리소스 식별자의 가장 흔한 형태이다.
- 특정 서버의 한 리소스에 대한 구체적인 위치를 서술한다.
- URL은 리소스가 정확히 어디에 있고 어떻게 접근할 수 있는지 분명히 알려준다.

`URL 표준 포맷`
- 첫번 째 부분은 스킴(scheme)라고 부른다. 리소스에 접근하는 프로토콜을 명시한다 (http://)
- 두번째 부분은 서버의 인터넷 주소를 제공한다 (www.naver.com)
- 마지막은 웹 서버의 리소스를 가리킨다. (/items/1)

> 오늘날 대부분의 URI는 URL이다.

##### 1.3.4 URN
- URI의 두 번째 종류는 유니폼 리소스 이름 (Uniform Resource Name) URN 이다.
- 콘텐츠를 이루는 한 리소스에 대해, 그 리소스의 위치에 영향 받지 않는 유일 무이한 이름 역할을 한다.

> 리소스가 이름을 변하지 않게 유지하는 한, 여러 종류의 네트워크 접속 프로토콜로 접근해도 문제없다.

#### 1.4 트랜잭션
- HTTP 트랜잭션은 요청 명령과 응답결과로 구성되어 있다.
- 이 상호작용은 HTTP 메시지라고 불리는 정형화된 데이터 덩어리를 이용해 이루어진다.

##### 1.4.1 메서드
- HTTP는 HTTP 메서드라고 불리는 여러 가지 종류의 요청 명령을 지원한다.
- 모든 HTTP 요청 메시지는 한 개의 메서드를 갖는다.

| HTTP 메서드 | 설명 |
|---|---|
| GET | 서버에서 클라이언트로 지정한 리소스를 보내라. |
| PUT | 클라이언트에서 서버로 보낸 데이터를 지정한 이름의 리소스로 저장하라. |
| DELETE | 지정한 리소스를 서버에서 삭제하라. |
| POST | 클라이언트 데이터를 서버 게이트웨이 애플리케이션으로 보내라. |
| HEAD | 지정한 리소스에 대한 응답에서, HTTP 헤더 부분만 보내라. |

##### 1.4.2 응답 코드
- 모든 HTTP 응답 메시지는 상태 코드와 함께 반환된다.
- 상태 코드는 클아이언트에게 요청이 성공했는지 추가 조치가 필요한지 알려주는 세자리 숫자이다.

| HTTP 상태코드 | 설명 |
|---|---|
| 200 | 문서가 올바르게 반환됨. |
| 302 | 다른 곳에 가서 리소스를 가져가라. |
| 404 | 리소스를 찾을 수 없다. |

##### 1.4.3 웹페이지는 여러 객체로 이루어질 수 있다
- 애플리케이션은 보통 하나의 작업을 수행하기 위해 여러 HTTP 트랜잭션을 수행 한다.
- 웹 브라우저는 시각적으로 풍부한 웹페이지를 가져올 때 대량의 HTTP 트랜잭션을 수행한다.

> 웹 페이지는 하나의 리소스가 아닌 리소스의 모음이다.


#### 1.5 메시지
- HTTP 메시지는 단순한 줄 단위의 문자열이다.
- 웹 클라이언트에서 웹 서버로 보낸 HTTP 메시지를 **요청 메시지**
- 웹 서버에서 웹 클라이언트로 보낸 HTTP 메시지를 **응답 메시지** 라고 한다.

`HTTP 메시지 구성`
- 시작줄
    - 요청이라면 무엇을 해야하는지, 응답이라면 무슨일이 일어났는지 나타낸다.

- 헤더
    - 시작줄 다음에는 0개 이상의 헤더 필드가 이어진다.
    - 쉬운 구문분석을 위해 쌍점(:) 으로 구분되어 있는 하나의 이름과 하나의 값으로 구성된다.
    - 헤더는 빈 줄로 끝난다.

- 본문
    - 빈 줄 다음 메시지 본문이 필요에 따라 올 수 있따.
    - 임의의 이진 데이터를 포함할 수 있다. (텍스트 포함)

```
[ 요청 메시지 ]
GET /test/hi ( 시작줄 )
--------------
Accept: text/* ( 헤더 )
Accept-Language: en, fr 

[ 응답 메시지 ]
HTTP/1.0 200 OK ( 시작줄 )
--------------
Content-type: text/plain ( 헤더 )
Content-Length: 19
--------------
Hi !!! ( 본문 )
```

#### 1.6 TCP 커넥션
- TCP ( Transmission Control Protocol, 전송 제어 프로토콜 ) 커넥션

##### 1.6.1 TCP/IP
- HTTP는 애플리케이션 계층 프로토콜 이다.
- 네트워크 통신 세부사항에 신경쓰지 않으며 **TCP/IP 프로토콜에게 맡긴다.**

`TCP`
- 오류없는 데이터 전송
- 순서에 맞는 전달 (데이터는 보낸순서로 도착한다.)
- 조각나지 않는 데이터 스트림 (언제든지 어떤 크기로든 보낼 수 있다.)

##### 1.6.2 접속, IP주소, 그리고 포트번호
- HTTP 클라이언트가 서버에 메시지를 전송 하기 전 인터넷 프로토콜 주소와 포트번호를 사용해 서버 사이에 TCP/IP 연결을 맺어야 한다.
- TCP 에서는 IP 주소와, 그 서버에서 실행중인 프로그램이 사용중인 포트번호가 필요하다.

`HTML 리소스를 사용자에게 보여주는 과정`
- 웹브라우저는 서버의 URL에서 호스트 명을 추출한다.
- 웹브라우저는 서버의 호스트 명을 IP로 변환한다.
- 웹브라우저는 URL에서 포트번호를 추출한다.
- 웹브라우저는 웹서버와 TCP 커넥션을 맺는다.
- 웹브라우저는 서버에 HTTP 요청을 보낸다.
- 서버는 웹브라우저에게 HTTP 응답을 돌려준다.
- 커넥션이 닫히면, 웹브라우저는 문서를 보여준다.


##### 1.6.3 텔넷(Telnet)을 이용한 실제 예제
- 텔넷은 HTTP 클라이언트는 잘 흉내 내지만 서버로서는 변변치 않다.

#### 1.7 프로토콜 버전
- 오늘날 쓰이고 있는 HTTP 프로노콜은 버전이 여러가지 이다.

###### HTTP/0.9
- 오직 GET 메서드만 지원하고, MIME타입, HTTP 헤더, 버전 번호는 지원하지 않는다.
- 간단한 HTML객체를 받아오기 위해 만들어진 것이다.
- 금방 HTTP/1.0 으로 대체되었다.

###### HTTP/1.0
- 처음으로 널리 쓰이기 시작한 HTTP 버전이다.
- 버전번호, HTTP 헤더, 추가 메서드, 멀티미디어 객체 처리를 추가했다.
- 시각적으로 매력적인 웹페이지와 상호작용하는 폼을 실현했고, 월드와이드웹을 대세로 만들었다.

###### HTTP/1.0+
- keep-alive 커넥션, 가상 호스팅 지원, 프락시 연결 지원을 포함해 많은 기능이 공식적이진 않지만 표준으로 추가되었다.

###### HTTP/1.1
- HTTP 설계의 구조적 결함 교정, 두드러진 성능 최적화, 잘못된 기능 제거에 집중했다.
- 현재의 HTTP 버전이다.

###### HTTP/2.0
- HTTP/2.0은 HTTP/1.1 성능 문제를 개선하기 위해 구그르이 SPDY 프로토콜을 기반으로 설계가 진행중인 프로토콜 이다.


#### 1.8 웹의 구성요소
- 프락시
    - 클라이언트와 서버사이에 위치한 HTTP 중재자
- 캐시
    - 많이 찾는 웹페이지를 클라이언트 가까이에 보관하는 HTTP 창고
- 게이트웨이
    - 다른 애플리케이션과 연결된 특별한 웹 서버
- 터널
    - 단순히 HTTP 통신을 전달하기만 하는 특별한 프락시
- 에이전트
    - 자동화된 HTTP 요청을 만드는 준 지능적 (semi-intelligenct) 웹 클라이언트

##### 1.8.1 프락시
- **웹 보안, 애플리케이션 통합, 성능 최적화를 위한 중요한 구성 요소**이다.
- 프락시는 클라이언트와 서버 사이에 위치하여 클라이언트의 모든 HTTP요청을 받아 서버에 전달한다.
- 주로 보안을 위해 사용된다. 모든 웹 트래픽 흐름 속에서 신뢰할 만한 중개자 역할을 한다.
    - 요청과 응답을 필터링 한다.

##### 1.8.2 캐시
- 웹캐시와 캐시 프락시는 자주 찾는 것의 사본을 저장해두는 특별한 종류의 HTTP 프락시 서버다.
- HTTP는 캐시를 효율적으로 동작하게 하고 캐시된 콘텐츠를 최신버전으로 유지하면서 동시에 프라이버시도 보호하기 위한 많은 기능을 정의한다.

##### 1.8.3 게이트웨이
- 다른 서버들의 중개자로 동작하는 특별한 서버다.
- 주로 HTTP 트래픽을 다른 프로토콜로 변환하기 위해 사용된다.
- 언제나 스스로가 리소스를 갖고 있는 진짜 서버인 것처럼 요청을 다룬다.

##### 1.8.4 터널
- 두 커넥션 사이에서 날(raw) 데이터를 열어보지 않고 그대로 전달해주는 HTTP 애플리케이션이다.
- 주로 비 HTTP 데이터를 하나 이상의 HTTP 연결을 통해 그대로 전송해주기 위해 사용된다.

> SSL 트래픽을 HTTP 커넥션으로 전송함으로써 웹 트래픽만 허용하는 사내 방화벽을 통과시키는 것이 있다.

##### 1.8.5 에이전트
- 사용자를 위해 HTTP 요청을 만들어주는 클라이언트 프로그램이다.
    - 웹 요청을 만드는 애플리케이션은 뭐든 HTTP 에이전트 이다.

### 2장 URL과 리소스
- URL (Uniform Resource Locator)은 인터넷의 리소스를 가리키는 표준이름이다.
- 전자정보 일부를 가리키고 그것이 어디에 있고 어떻게 접근할 수 있는지 알려준다.

#### 2.1 인터넷의 리소스 탐색하기
- URL은 브라우저가 정보를 찾는데 필요한 리소스의 위치를 가리킨다.
- URL은 통합 자원 식별자 혹은 URI 라고 불리는 더 일반화된 부류의 부분 집합이다.
- URI는 두가지 주요 부분집합인, URL, URN으로 구성된 종합적인 개념이다.

```
http://www.naver.com/posts/1
```

- URL의 첫 부분인 http는 URL의 스킴이다. 웹 클라이언트가 리소스에 어떻게 접근하는지 알려준다.
- 두번째 부분은 서버의 위치다. 웹 클라이언트가 리소스가 어디에 호스팅되어 있는지 알려준다.
- 세번째 부분인 /posts/1 은 리소스의 경로이다.

> 대부분의 URL은 '스킴://서버위치/경로' 구조로 되어 있다.

##### 2.1.1 URL이 있기 전 암흑의 시대 
- 웹과 URL이 있기전 네트워크 상 산재해있는 데이터에 접근하기 위해 애플리케잇녀마다 달리 가지고 있는 분류방식을 사용 했다.

> URL은 브라우저가 더 영리하게 리소스에 접근하고 그것을 다루게 함으로써 온라인 세상을 단순화 시킨다.

#### 2.2 URL 문법
- URL 문법은 스킴에 따라서 달라진다.
- 대부분의 URL은 일반 URL문법을 따르며, 서로 다른 URL 스킴도 형태와 문법 면에서 매우 유사하다.

대부분의 URL 스킴의 문법은 일반적으로 9개 부분으로 나뉜다.
> <스킴>://<사용자이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>?<질의>#<프래그먼트>

##### 2.2.1 스킴: 프로토콜
- 스킴은 르소스에 어떻게 접근하는지 알려주는 매우 중요한 정보다.
- 스킴 컴포넌트는 알파벳으로 시작해야 하고 URL의 나머지 부분들과 첫번째':' 문자로 구분한다. 또한 대소문자를 가리지 않는다.

##### 2.2.2 호스트와 포트
- 리소스를 찾으려면, 리소스를 호스팅하고 있는 장비와 그 장비내에 접근할수 있는 서버가 어디있는지 알아야한다.
- URL의 호스트와 포트 컴포넌트는 그 두가지 정보를 제공해준다.
- 내부적으로 TCP 프로토콜을 사용하는 HTTP는 기본포트로 80을 사용한다.

##### 2.2.3 사용자 이름과 비밀번호
- 많은 서버가 자신이 가지고있는 데이터에 접근을 허용하기 전에 사용자 이름과 비밀번호를 요구한다.
- FTP서버가 좋은 예 이다.

```
ftp://anonymous@ftp.prep.ai.mit.edut/pub/gnu
```

##### 2.2.4 경로
- URL의 경로 컴포넌트는 리소스가 서버의 어디에 있는지 알려준다.
- 해당 경로는 계층적 파일 시스템 경로와 유사한 구조를 가진다.

> https://www.naver.com/posts/1

##### 2.2.5 파라미터
- URL의 파라미터 컴포넌트는 애플리케이션이 서버에 정확한 요청을 하기 위해 필요한 입력 파라미터를 받는데 사용한다.
- 이름/값 쌍의 리스트로 URL 나머지 부분들로 부터 ';' 문자로 구분하여 URL에 기술한다.

##### 2.2.6 질의 문자열
- 데이터베이스 같은 서비스들은 요청받을 리소스 형식의 범위를 좁히기 위해 질문이나 질의를 받을 수 있다.
- 다음과 같이 물음표 우측에 있는 값들을 질의 컴포넌트라고 부른다.
- 게이트웨이를 가리키는 URL경로 컴포넌트와 함께 전달하고 있다.
- 편의상 많은 게이트웨이가 '&'로 나뉜 '이름=값' 쌍 형식의 질의 문자열을 원한다.
```
http://www.joes-hardware.com/inveintory-check.cgi?item=12731
``` 

##### 2.2.7 프래그먼트
- HTML 같은 리소스 형식들은 본래의 수준보다 더 작게 나뉠 수 있다.
- 리소스의 특정 부분을 가리킬 수 있도록 URL은 리소스 내의 조각을 가리킬 수 있는 프래그먼트 컴포넌트를 제공한다.
- 예를 들면 HTML문서에 있는 특정 이미지나 일부분을 가리킬 수 있다.

#### 2.3 단축 URL
- 웹 클라이언트는 몇몇 단축 URL을 인식하고 사용한다.
- 상대 URL은 리소스내에 존재하는 리소스를 간결하게 기술하는데 사용할 수 있다.

##### 2.3.1 상대 URL
- URL은 절대 URL, 상대 URL로 나뉜다.
- 절대 URL은 리소스에 접근하는데 필요한 모든 정보를 가지고 있따.
- 상대 URL은 모든 정보를 담고 있지는 않다.
    - 상대 URL로 리소스에 접근하는데 필요한 모든 정보를 얻기위해서, 기저(Base) URL을 사용해야 한다.
    
```
// 기저 URL: [ ] 내의 부분 
[http://www.naver.com]/tools.html

// 상대 URL
./hammer.html
```

##### 2.3.2 URL 확장
- 어떤 브라우저 들은 URL을 입력한 다음이나 입력하고 있는 동안 자동으로 URL을 확장한다.
- 이러한 확장 기능은 두가지로 나뉜다.

`호스트 명 확장`
- 단순한 휴리스틱만을 사용해서 입력한 호스트 명을 전체 호스트명으로 확장할 수 있다.
- yahoo 라고 입력할 경우 www.yahoo.com 을 만든다.

> 프락시와 같은 다른 HTTP 애플리케이션에 문제를 발생시킬 수도 있다.

`히스토리 확장`
- 과거에 사용자가 방문했던 URL의 기록을 저장해 놓는 것이다.
- URL을 입력하면 그 입력된 URL의 앞 글자들을 포함하는 완결된 형태의 URL 들을 선택하게 해준다.

> 프락시를 사용할 경우 다르게 동작 할 수 있다.


#### 2.4 안전하지 않은 문자
- URL 설계자는 사람들이 URL에 이진 데이터나 일반적으로 안전한 알파벳 외 문자도 포함하려고 할 떄가 있다는 것을 알게 되었다.
- 그래서 이스케이프 라는 기능을 추가하여, 안전하지 않은 문자를 안전한 문자로 인코딩 할 수 있게 하였다.

##### 2.4.1 URL 문자 집합
- US-ASCII는 문자를 서식화 하고 하드웨어상에서 신호를 주고받기 위해, 7비트를 사용하여 영문 자판에 있는 키 대부분과 몇몇 출력되지 않는 제어문자를 표현한다.
- URL 설계자 들은 이스케이프 문자열을 쓸 수 있게 설계 하였다.
- 이스케이프 문자열은 US-ASCII 에서 사용이 금지된 문자들로, 특정 문자나 데이터를 인코딩할 수 있게 함으로써 이동성과 완성도를 높혔다.

##### 2.4.2 인코딩 체계
- 인코딩은 안전하지 않는 문자를 퍼센티지 기호로 시작해, ASCII 코드로 표현되는 두 개의 16진수 숫자로 이루어진 '이스케이프' 문자로 바꾼다.

##### 2.4.3 문자 제한
- 몇몇 문자는 URL 내에서 특별한 의미로 예약되어 있다.

| 문자 | 설명 |
|---|---|
| & | 인코딩된 문자에 사용할 이스케이프 토큰으로 선점 |
| / | 경로 컴포넌트에 있는 경로 세그먼트를 나누눈 용도로 선점 |
| . | 경로 컴포넌트에서 선점 |
| .. | 경로 컴포넌트에서 선점 |
| # | 프래그먼트의 구획 문자로 선점 |
| ? | 질의 문자열의 구획 문자로 선점 |
| ; | 파라미터의 구획 문자로 선점 |
| : | 스킴, 사용자 이름/비밀번호, 호스트/포트의 구획 문자로 선점 |
| $, + | 선점 |
| @&= | 특정 스킴에서 특별한 의미가 있기 때문에 선점 |
| {}\~[]₩ | 게이트웨이와 같은 여러 전송 에이전트에서 불안전하게 다루기 때문에 제한됨  |
| <>" | 안전하지 않음 URL 범위 밖에서 역할이 있는 문자열이기 때문에 반드시 인코딩 해야함 |
| 0x00-0x1F, 0x7F | 제한됨, 이 16진수 범위에 속하는 문자들은 인쇄되지 않는 US-ASCII 문자 |
| > 0x7F | 제한됨, 이 16진수 범위에 속하는 문자들은 7비트 US-ASCII 문자가 아님 |

#### 2.5 스킴의 바다

| 스킴 | 설명 |
|---|---|
| http | 사용자 이름이나 비밀번호가 없다는 것을 제외하고, 일반 URL 포맷을 지키는 하이퍼텍스트 전송 프로토콜이다. 기본포트는 80 |
| https | http 스킴과 거의 같다. HTTP 커넥션 양 끝단에서 암호화하기위한 SSL 을 사용한다. 기본포트는 443 |
| mailto | 이메일 주소를 가리킨다. 다른 스킴과 다르게 동작하기 때문에 표준 URL과 다른 포맷을 가진다. RFC 822에 기술되어 있다. |
| ftp | 파일 전송 프로토콜은 FTP 서버에 있는 파일을 내려받거나 올리고, 디렉터리의 콘텐츠 목록을 가져오는데 사용할 수 있다. |
| rtsp, rtspu | 실시간 스트리밍 프로토콜을 통해 읽을 수 있는 오디오 및 비디오와 같은 미디어 리소스 식별자이다. |
| file | 주어진 호스트 기기에서 바로 접근 할 수 있는 파일들을 나타낸다. 만약 호스트가 생략되어 있다면 로컬호스트가 기본 값이다. |
| news | news 스킴은 RFC 1036 정의된 바와 같이 특정 문서나 뉴스 그룹에 접근하는데 사용한다. 리소스의 위치 정보를 포함하지 않는다. |
| telnet | 대화형 서비스에 접근하는데 사용한다. |
