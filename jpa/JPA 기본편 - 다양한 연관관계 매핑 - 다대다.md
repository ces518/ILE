# JPA 기본편 - 다양한 연관관계 매핑 - 다대다

#### 다대다
- 실무에서는 안쓰는것을 권장
- 관계형 데이터베이스는 정규화된 테이블 2개로 다대다 관계를 표현할 수 없ㅇ므
- 연결 테이블(조인테이블)을 추가해서 일대다, 다대일 관계로 풀어내야 한다.

- MEMBER
    - MEMBER_ID (PK)
    - USERNAME
- MEMBER_PRODUCT
    - MEMBER_ID (PK, FK)
    - PRODUCT_ID (PK, FK)
- PRODUCT
    - PRODUCT_ID (PK)
    - NAME

- 객체는 컬렉션을 사용해서 객체 2개로 다대다 관계 가능
    - 객체는 다대다가 가능하다..

> 객체의 다대다를 테이블의 중간테이블을 넣어 매핑을 해준다.
- @ManyToMany
- @JoinTable로 연결테이블을 지정할 수 있다.
- 단방향, 양방향 모두 가능하다.
- @OneToOne과 동일한 방식이지만, 중간에 연결테이블이 존재한다는 차이점 이 있다.

#### 다대다 매핑의 한계
- 편리해 보이지만, 실무에서 사용 X
- 연결 테이블이 단순히 연결만 하고 끝나지 않는다.
- 주문시간, 수량 .. 등등 추가 데이터가 들어올 수 있다.
    - 이러한 부분 자체를 추가할 수 없다.
- 쿼리도 예측하지못하는 쿼리가 나간다..

> 매핑정보만 들어갈 뿐 추가적인 정보를 넣을 수 없다

* 사용하지 않는것을 추천한다.

#### 다대다 매핑의 한계 극복
- 연결 테이블용 엔티티를 추가한다.
    - 중간테이블을 엔티티로 승격시킨다.
- 원하는 추가정보를 넣을 수 있다.
- @OneToMany, @ManyToOne을 사용해 풀어낸다.

- MEMBER
    - MEMBER_ID (PK)
    - USERNAME
- MEMBER_PRODUCT
    - MEMBER_PRODUCT_ID (PK)
    - MEMBER_ID (FK)
    - PRODUCT_ID (FK)
- PRODUCT
    - PRODUCT_ID (PK)
    - NAME

> 비즈니스는 상당히 복잡하기 떄문에 @ManyToMany로 단순하게 풀어낼 수 있는것은 거의 없다... 연결테이블을 엔티티로 승격시킬것

- 전통적인 방식으로는 MEMBER_ID, PRODUCT_ID 를 각각 복합키로 사용하는 설계 이다.
    - 데이터 베이스 관점의 설계
- 하지만 어지간하면 PK는 아무런 의미가 없는 값을 사용하는것을 추천한다.
    - 확장하기에 좋음
    - 운영을 하는 도중에 유연성이 좋아짐..
    - 필요할 경우 제약조건을 추가하는 방식을 사용


#### 정리
- 다대다는 최대한 쓰지말것
- 실무에서 쓸만한 매핑이 아니다.
- @ManyToMany를 사용할때 연결테이블만으로 해결되는 간단한 케이스는 실무에서 거의 없다.
- PK는 최대한 비즈니스와 관계없는 의미없는 값을 사용할것
    - 추후 애플리케이션 확장및 유연성에 좋다.
