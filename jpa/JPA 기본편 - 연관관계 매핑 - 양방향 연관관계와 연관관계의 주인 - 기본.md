# JPA 기본편 - 연관관계 매핑 - 양방향 연관관계와 연관관계의 주인 - 기본

#### 양방향 매핑
- Member
    - id
    - team
    - username
- Team
    - id
    - name
    - members
- MEMBER
    - MEMBER_ID (PK)
    - TEAM_ID (FK)
    - USERNAME
- TEAM
    - TEAM_ID (PK)
    - NAME

> 양쪽으로 참조해서 사용할수 있는것을 양방향 연관관계라고 한다.

#### 객체의 참조와 테이블의 외래키의 차이
- 테이블 연관관계에는 영향이 없다.
- 테이블의 연관관계에는 방향이라는 개념이 없다.
- FK 하나만으로 서로의 연관을 알 수 있다.
- 객체에서는 참조를 가지고 있어야만 양방향으로 연관관계를 맺을 수 있다.

#### 양방향 매핑
- 반대 방향으로 객체 그래프 탐색이 가능하다.
- 가능하면 단방향 매핑이 좋다.
- 양방향 매핑을 할 경우 신경쓸 것이 많아진다.

#### 연관관계의 주인과 mappedBy
- mappedBy = JPA의 멘붕 난이도
- mappedBy는 처음에 이해하기 어렵다.
- 객체와 테이블 간의 연관관계를 맺는 차이를 이해하면 된다.

#### 객체와 테이블이 관계를 맺는 차이
- 객체 연관관계는 2개이다.
    - 회원 -> 팀 (단방향)
    - 팀 -> 회원 (단방향)

> 객체 연관관계는 단방향 연관관계가 2개가 있는것이다.

- 테이블의 연관관계는 1개이다.
    - 회원 <-> 팀 (양방향)

#### 객체의 양방향 관계
- 객체의 양방향 관계는 사실 **양방향 관계가 아닌 서로 다른 단방향 관계 2개**이다.
- 객체를 양방향으로 참조하려면 **단방향 연관관계를 2개** 만들어야 한다.

#### 테이블의 양방향 관계
- 테이블의 연관관계는 외래키 하나로 앙뱡항 관계를 ㅁ관리한다.
- MEMBER.TEAM_ID 하나로 앙뱡항 연관관계를 가진다.
- 양쪽으로 조인을 할 수 있다.
```sql
select *
from member m
join team t
on m.team_id = t.team_id;

select * 
from team t
join member m
on t.team_id = m.team_id;
```

#### 둘 중 하나로 외래 키를 관리해야 한다.
- Member의 team으로 외래키를 관리할지, Team의 members로 외래키를 관리할지 룰을 지정해야한다.
- 이것이 연관관계의 주인이다.

#### 연관관계의 주인
- 양방향 매핑 규칙
    - 객체의 두 관계중 하나를 연관관계 주인으로 지정
    - 연관관계의 주인만이 외래키를 관리 (등록, 수정)
    - 주인이 아닌 쪽은 읽기만 가능ㄴ
    - 주인은 mappedBy 속성 X
    - 주인이 아니라면 mappedBy 속성으로 주인을 지정해야한다.

> 양방향 연관관계에서는 연관관계 주인이 존재하며, mappedBy가 존재하는 쪽은 주인이 아니다.

> DB에 값을 등록하거나 수정하는 것은 주인만 참조를 한다.

#### 누구를 주인으로 ?
- 외래 키가 있는 쪽을 주인으로 정해라
- 여기서는 Member.team이 연관관계의 주인

> 외래키가 없는 곳을 주인으로 정하면 Team의 members를 수정했는데 Member의 업데이트가 날아간다던지 성능상 이슈도 있다.

> ManyToOne N:1 에서 N쪽이 연관관계의 주인이 되는것이 가장 깔끔하게 나온다.
