# JPA 기본편 - 플러시

#### 플러시
- 영속성 컨텍스트이 변경 사항을 데이터베이스에 반영하는것
- 보통 트랜잭션이 커밋될때 플러시가 일어난다.

> 영속성 컨텍스트의 쿼리들을 DB에 질의 해주는 과정

#### 플러시 발생
- 변경 감지
- 수정된 엔티티 쓰기 지연 SQL 저장소에 등록
- 쓰기지연 SQL 저장소의 쿼리를 데이터베이스에 전송한다.
    - 등록, 수정, 삭제 쿼리

#### 플러시를 하는 방법
- em.flush(); 
    - 직접 호출
    - 쓸일은 거의 없다..
- 트랜잭션커밋 
    - 자동으로 flush 호출
- JPQL 쿼리 실행
    - 자동으로 flush 호출


```java
Member newMember2 = new Member();
newMember2.setId(200L);
newMember2.setName("HELLO 200 Member");
entityManager.persist(newMember2); // 영속성 컨텍스트에 저장소에 쿼리를 저장
entityManager.flush(); // 저장소의 쿼리를 DB에 강제로 반영
// flush 를 하더라도 1차캐시는 유지된다.
```

> flush 를 하더라도 1차캐시는 유지된다

JPA 는 JPQL 실행시 데이터 싱크가 맞지않기 때문에 DB에서 조회가 되지않는 문제 등이 발생할 여지가 있기때문에 기본값으로 flush를 호추랗ㄴ다.

#### 플러시 모드 옵션
- FlushModeType.AUTO
    - 커밋이나 쿼리르 실행할때만 플러시 (기본값)
- FlushModeType.COMMIt
    - 커밋을 할때만 플러시를 한다.

> 옵션을 손댈일도 거의 없고 손대지 않는것을 권장

#### 정리
- persist는 영속성 컨텍스트에 저장소에 쿼리를 저장한다.
- flush는 저장소의 쿼리르 DB에 질의한다.
- 트랜잭션이라는 작업 단위가 중요하다.
    - 데이터베이스 트랜잭션이라는 단위가 있어서 가능한 것이다.
    - 커밋 직전에만 동기화 하면됨
- JPA는 데이터 동시성 등과 관련된 작업들은 모두 데이터베이스에게 위임한다.
