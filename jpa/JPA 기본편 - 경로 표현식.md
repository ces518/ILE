# JPA 기본편 - 경로 표현식

#### 경로 표현식
- 점을 찍어 객체 그래프를 탐색하는 것
```java
select m.username // 상태 필드
from Member m
join m.team t // 단일 값 연관 필드
join m.orders o // 컬렉션 값 연관 필드
where t.name = '팀A'
```

- 엔티티의 필드의 경우 상태필드 라고한다.
- 필드가 엔티티일 경우 단일 값 연관 필드, 컬렉션 일 경우 컬렉션 값 연관필드라고 한다.

> 이 세가지의 경우 각각의 경우의 결과가 달라진다. (내부 동작방식이 다름) 반드시 세가지를 구분할줄 알아야 한다.

#### 경로 표현식 용어
- 상태 필드
    - 단순히 값을 저장하기 위한 필드

- 연관필드
    - 연관관계를 위한 필드
    - 단일값 연관필드
        - @ManyToOne, @OneToOne
        - 엔티티 대상

    - 컬렉션 값 연관필드
        - @OneToMany, @ManyToMany
        - 컬렉션 대상

#### 경로 표현식 특징
- 상태 필드
    - 경로 탐색의 끝, 더이상 탐색이 불가능하다.

- 단일 값 연관 경로
    - 묵시적 조인이 발생한다.
    - 묵시적 조인이 발생하도록 JPQL을 짜서는 안된다.
    - 운영단계에서 매우 어려워진다.

```java
// 상태 필드 경로 표현식
em.createQuery("select m.username from Member m");

// 단일 값 연관 경로 표현식
// 묵시적인 내부 조인이 발생한다.
// 추가적인 탐색이 가능하다.
// 묵시적인 내부조인이 발생하도록 JPQL을 짜서는 안된다.
// 성능 튜닝 단계에서 영향을 미친다.
// 왠만하면 JPQL 과 SQL을 맞추는것을 추천한다.
em.createQuery("select m.team.id, m.team.name from Member m");
```

#### 명시적 조인, 묵시적 조인
- 명시적조인
    - join 키워드를 직접 사용

- 묵시적조인
    - 경로 표현식에 의해 묵시적인 조인이 발생
    - 내부조인만 가능하다.

```java
// 컬렉션 값 연관경로
// 컬렉션의 경우 어떠한 값을 꺼내야할지 난감하다.
// JPA의 경우에는 제약을 두었음
// 컬렉션 값 연관경로의 경우 묵시적 내부 조인이 발생하지만 추가 탐색은 불가능하다.
// * From 절에서 명시적 조인을 통해 알리아스(별칭) 을 얻어온다면, 별칭을 통해 탐색이 가능하다.
em.createQuery("select t.members from Team t");
```

#### 경로 탐색을 사용한 묵시적 조인 사용시 주의사항
- 항상 내부조인이 일어난다.
- 컬렉션은 경로 탐색의 끝, 명시적 조인을 통해 별칭을 얻어 사용해야한다.
- 경로 탐색은 주로 SELECT, WHERE 절에서 사용하지만, 묵시적 조인으로 이해 SQL의 JOIN 절에 영향을 미친다. (JOIN 유발)


> 가급적 묵시적 조인대신 명시적 조인을 사용할것, 조인은 SQL 튜닝에 중요 포인트이다.
